<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MeowMate - Items</title>

<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  body { font-family: 'Segoe UI', sans-serif; min-height: 100vh; margin: 0; }

  /* Sidebar styles */
  .sidebar {
    position: fixed; top: 0; left: 0; height: 100%; width: 250px;
    background: #2c2c2c; color: white; padding: 20px; display: flex; flex-direction: column;
  }
  .sidebar h4 { color: #fff; margin-bottom: 20px; }
  .sidebar a { color: #fff; text-decoration: none; padding: 10px 0; display: block; transition: background 0.3s; }
  .sidebar a:hover, .sidebar a.active { background: #444; border-radius: 8px; }

  /* Main content */
  .main { margin-left: 250px; padding: 20px; min-height: 100vh; }

  /* Smooth fade-in animation for item cards */
  @keyframes fadeInUp {
    0% { opacity: 0; transform: translateY(20px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  .item-card {
    animation: fadeInUp 0.5s ease forwards;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .item-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 20px 35px rgba(0,0,0,0.15);
  }

  /* Modal style */
  #itemModalWrapper { 
    z-index: 50; 
  }

  @media (max-width: 768px) {
    .main { margin-left: 0; padding: 10px; }
  }
</style>
</head>
<body class="bg-gray-100">

<!-- Sidebar -->
<div class="sidebar">
  <h4>üêæ Meow Mate</h4>
  <nav class="flex flex-col mt-4">
    <a class="nav-link active" href="AdminListings.html">üìÑ Listings</a>
    <a class="nav-link" href="AdminDashBord.html">üëë Admin Panel</a>
    <a class="nav-link" href="adminSetting.html">‚öô Setting</a>
    <a class="mt-auto" href="#" onclick="logout()">üö™ Logout</a>
  </nav>
</div>

<!-- Main content -->
<div class="main">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-purple-600">üì¶ Items</h2>
    <button id="addItemBtn" class="bg-purple-600 text-white px-5 py-2 rounded-lg shadow hover:bg-purple-700 transition">
      <i class="fas fa-plus mr-2"></i> Add Item
    </button>
  </div>

  <!-- Items Grid -->
  <div id="itemsContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
</div>

<!-- Modal -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center hidden" id="itemModalWrapper">
  <div class="bg-white rounded-xl shadow-xl w-full max-w-lg overflow-hidden">
    <form id="itemForm" class="p-6 space-y-4">
      <h2 class="text-2xl font-semibold text-purple-600 text-center">Add Item</h2>
      <input type="hidden" id="itemId">
      
      <div>
        <label class="block text-gray-700 font-medium mb-1">Listing Name</label>
        <input type="text" id="listingName" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-1">Description</label>
        <textarea id="listingDescription" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-purple-500 focus:outline-none" required></textarea>
      </div>

      <div class="flex gap-4">
        <div class="flex-1">
          <label class="block text-gray-700 font-medium mb-1">Price</label>
          <input type="text" id="price" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
        </div>
        <div class="flex-1">
          <label class="block text-gray-700 font-medium mb-1">Quantity</label>
          <input type="number" id="quantity" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
        </div>
      </div>

      <div>
        <label class="block text-gray-700 font-medium mb-1">Image</label>
        <input type="file" id="imageFile" accept="image/*" class="w-full text-gray-600">
      </div>

      <div class="flex justify-end gap-3">
        <button type="button" id="cancelBtn" class="bg-gray-200 text-gray-700 px-5 py-2 rounded-lg hover:bg-gray-300 transition">Cancel</button>
        <button type="submit" class="bg-purple-600 text-white px-5 py-2 rounded-lg hover:bg-purple-700 transition">Save Item</button>
      </div>
    </form>
  </div>
</div>

<script>
const apiUrl = "http://localhost:8080/api/items";
const itemsContainer = document.getElementById('itemsContainer');
const addItemBtn = document.getElementById('addItemBtn');
const itemModalWrapper = document.getElementById('itemModalWrapper');
const cancelBtn = document.getElementById('cancelBtn');
const itemForm = document.getElementById('itemForm');
let editingId = null;

// Show modal
addItemBtn.addEventListener('click', () => { itemModalWrapper.classList.remove('hidden'); });

// Hide modal
cancelBtn.addEventListener('click', () => {
  itemModalWrapper.classList.add('hidden');
  itemForm.reset();
  editingId = null;
});

// Prevent form submit on Enter key except in textarea
itemForm.addEventListener('keydown', function(e) {
  if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
    e.preventDefault();
  }
});

// Load items
const loadItems = async () => {
  try {
    const res = await fetch(apiUrl);
    const items = await res.json();
    itemsContainer.innerHTML = "";
    items.forEach(item => {
      const card = document.createElement('div');
      card.className = "bg-white rounded-xl shadow-lg overflow-hidden item-card";
      card.innerHTML = `
        <img src="${item.imageUrl || 'https://via.placeholder.com/250x180'}" class="w-full h-48 object-cover">
        <div class="p-4">
          <h3 class="text-lg font-semibold text-gray-800 mb-2">${item.listingName}</h3>
          <p class="text-gray-600 mb-2">${item.listingDescription}</p>
          <p class="text-gray-800 font-medium mb-2">Price: <span class="text-purple-600">${item.price}</span></p>
          <p class="text-gray-800 font-medium mb-4">Qty: ${item.quantity}</p>
          <div class="flex gap-2 justify-end">
            <button class="bg-yellow-400 text-white p-2 rounded-lg hover:bg-yellow-500 transition" onclick="editItem(${item.id})"><i class="fas fa-edit"></i></button>
            <button class="bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition" onclick="deleteItem(${item.id})"><i class="fas fa-trash"></i></button>
          </div>
        </div>
      `;
      itemsContainer.appendChild(card);
    });
  } catch(err) { console.error("Error loading items:", err); }
};

// Add / Update item
itemForm.addEventListener('submit', async (e) => {
  e.preventDefault(); // stop page refresh
  const formData = new FormData();
  formData.append("listingName", document.getElementById('listingName').value);
  formData.append("listingDescription", document.getElementById('listingDescription').value);
  formData.append("price", document.getElementById('price').value);
  formData.append("quantity", document.getElementById('quantity').value);
  const file = document.getElementById('imageFile').files[0];
  if(file) formData.append("image", file);

  try {
    if(editingId) {
      await fetch(`${apiUrl}/${editingId}`, { method: "PUT", body: formData });
      editingId = null;
    } else {
      await fetch(`${apiUrl}/save`, { method: "POST", body: formData });
    }
    itemModalWrapper.classList.add('hidden');
    itemForm.reset();
    loadItems(); // dynamically reload items
  } catch(err) { console.error("Error saving item:", err); }
});

// Edit item
window.editItem = async (id) => {
  try {
    const res = await fetch(apiUrl);
    const items = await res.json();
    const item = items.find(i => i.id === id);
    document.getElementById('listingName').value = item.listingName;
    document.getElementById('listingDescription').value = item.listingDescription;
    document.getElementById('price').value = item.price;
    document.getElementById('quantity').value = item.quantity;
    editingId = id;
    itemModalWrapper.classList.remove('hidden');
  } catch(err) { console.error("Error editing item:", err); }
};

// Delete item
window.deleteItem = async (id) => {
  if(confirm("Are you sure you want to delete this item?")) {
    try {
      await fetch(`${apiUrl}/${id}`, { method: "DELETE" });
      loadItems();
    } catch(err) { console.error("Error deleting item:", err); }
  }
};

// Logout function
function logout() {
  localStorage.removeItem('token');
  window.location.href = 'SignIn.html';
}

// Initial load
loadItems();
</script>

</body>
</html>
